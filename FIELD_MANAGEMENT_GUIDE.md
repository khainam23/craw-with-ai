# H∆∞·ªõng D·∫´n Th√™m/X√≥a Tr∆∞·ªùng Trong D·ª± √Ån Crawl B·∫•t ƒê·ªông S·∫£n

## T·ªïng Quan

D·ª± √°n n√†y s·ª≠ d·ª•ng Pydantic ƒë·ªÉ ƒë·ªãnh nghƒ©a c·∫•u tr√∫c d·ªØ li·ªáu b·∫•t ƒë·ªông s·∫£n. Khi c·∫ßn th√™m ho·∫∑c x√≥a tr∆∞·ªùng, b·∫°n c·∫ßn c·∫≠p nh·∫≠t ·ªü 2 file ch√≠nh:
- `models.py`: ƒê·ªãnh nghƒ©a c·∫•u tr√∫c d·ªØ li·ªáu
- `enhanced_crawler.py`: Logic crawl v√† extract d·ªØ li·ªáu

## üìã C·∫•u Tr√∫c D·ª± √Ån

```
d:\Learn\craw-data-by-ai\
‚îú‚îÄ‚îÄ models.py              # ƒê·ªãnh nghƒ©a PropertyModel v√† PropertyImage
‚îú‚îÄ‚îÄ enhanced_crawler.py    # Logic crawl v√† extract d·ªØ li·ªáu
‚îú‚îÄ‚îÄ requirements.txt       # Dependencies
‚îî‚îÄ‚îÄ FIELD_MANAGEMENT_GUIDE.md  # File n√†y
```

## ‚ûï C√°ch Th√™m Tr∆∞·ªùng M·ªõi

### B∆∞·ªõc 1: Th√™m Tr∆∞·ªùng V√†o PropertyModel

M·ªü file `models.py` v√† th√™m tr∆∞·ªùng m·ªõi v√†o class `PropertyModel`:

```python
# V√≠ d·ª•: Th√™m tr∆∞·ªùng th√¥ng tin v·ªÅ an ninh
security_system: Optional[Literal['Y', 'N']] = Field(None, description="C√≥ h·ªá th·ªëng an ninh kh√¥ng? ('Y' ho·∫∑c 'N')")
security_camera: Optional[Literal['Y', 'N']] = Field(None, description="C√≥ camera an ninh kh√¥ng? ('Y' ho·∫∑c 'N')")
security_guard: Optional[str] = Field(None, description="Th√¥ng tin v·ªÅ b·∫£o v·ªá")

# V√≠ d·ª•: Th√™m tr∆∞·ªùng th√¥ng tin v·ªÅ m√¥i tr∆∞·ªùng
noise_level: Optional[str] = Field(None, description="M·ª©c ƒë·ªô ti·∫øng ·ªìn (th·∫•p/trung b√¨nh/cao)")
air_quality: Optional[str] = Field(None, description="Ch·∫•t l∆∞·ª£ng kh√¥ng kh√≠")
green_space_nearby: Optional[Literal['Y', 'N']] = Field(None, description="C√≥ kh√¥ng gian xanh g·∫ßn ƒë√≥ kh√¥ng? ('Y' ho·∫∑c 'N')")
```

### B∆∞·ªõc 2: C·∫≠p Nh·∫≠t Logic Extract Trong enhanced_crawler.py

M·ªü file `enhanced_crawler.py` v√† t√¨m method `_extract_comprehensive_data()`:

1. **Th√™m tr∆∞·ªùng v√†o extracted_data dictionary** (kho·∫£ng d√≤ng 89-237):

```python
# Th√™m v√†o ph·∫ßn kh·ªüi t·∫°o extracted_data
extracted_data = {
    # ... c√°c tr∆∞·ªùng hi·ªán t·∫°i ...
    
    # Th√¥ng tin an ninh (th√™m m·ªõi)
    'security_system': None,
    'security_camera': None,
    'security_guard': None,
    
    # Th√¥ng tin m√¥i tr∆∞·ªùng (th√™m m·ªõi)
    'noise_level': None,
    'air_quality': None,
    'green_space_nearby': None,
    
    # ... ti·∫øp t·ª•c v·ªõi c√°c tr∆∞·ªùng kh√°c ...
}
```

2. **Th√™m logic extract cho tr∆∞·ªùng m·ªõi** trong c√°c method extract:

```python
def _extract_from_html_patterns(self, html: str, extracted_data: Dict[str, Any]) -> Dict[str, Any]:
    """
    Extract d·ªØ li·ªáu t·ª´ HTML patterns
    """
    if not html:
        return extracted_data
    
    # ... logic hi·ªán t·∫°i ...
    
    # Extract th√¥ng tin an ninh
    if re.search(r'„Çª„Ç≠„É•„É™„ÉÜ„Ç£|security|Èò≤ÁäØ', html, re.IGNORECASE):
        extracted_data['security_system'] = 'Y'
    
    if re.search(r'Áõ£Ë¶ñ„Ç´„É°„É©|security camera|Èò≤ÁäØ„Ç´„É°„É©', html, re.IGNORECASE):
        extracted_data['security_camera'] = 'Y'
    
    # Extract th√¥ng tin m√¥i tr∆∞·ªùng
    noise_match = re.search(r'È®íÈü≥„É¨„Éô„É´|noise level|Èùô„Åã|„ÅÜ„Çã„Åï„ÅÑ', html, re.IGNORECASE)
    if noise_match:
        # Logic ƒë·ªÉ x√°c ƒë·ªãnh m·ª©c ƒë·ªô ti·∫øng ·ªìn
        extracted_data['noise_level'] = 'low'  # ho·∫∑c logic ph·ª©c t·∫°p h∆°n
    
    return extracted_data
```

### B∆∞·ªõc 3: C·∫≠p Nh·∫≠t Schema Example (T√πy Ch·ªçn)

Trong `models.py`, c·∫≠p nh·∫≠t `schema_extra` example:

```python
schema_extra = {
    "example": {
        # ... c√°c tr∆∞·ªùng hi·ªán t·∫°i ...
        "security_system": "Y",
        "security_camera": "Y",
        "noise_level": "low",
        "green_space_nearby": "Y"
    }
}
```

## ‚ûñ C√°ch X√≥a Tr∆∞·ªùng

### B∆∞·ªõc 1: X√≥a Tr∆∞·ªùng Kh·ªèi PropertyModel

M·ªü file `models.py` v√† x√≥a/comment tr∆∞·ªùng kh√¥ng c·∫ßn thi·∫øt:

```python
# V√≠ d·ª•: X√≥a tr∆∞·ªùng kh√¥ng c·∫ßn thi·∫øt
# bs: Optional[Literal['Y', 'N']] = Field(None, description="C√≥ BS (v·ªá tinh ph√°t s√≥ng) kh√¥ng? ('Y' ho·∫∑c 'N')")
```

### B∆∞·ªõc 2: X√≥a Kh·ªèi enhanced_crawler.py

1. **X√≥a kh·ªèi extracted_data dictionary**:

```python
extracted_data = {
    # ... c√°c tr∆∞·ªùng kh√°c ...
    # 'bs': None,  # X√≥a d√≤ng n√†y
}
```

2. **X√≥a logic extract li√™n quan**:

```python
# X√≥a ho·∫∑c comment c√°c ƒëo·∫°n code extract cho tr∆∞·ªùng ƒë√£ x√≥a
# if re.search(r'BS|satellite', html, re.IGNORECASE):
#     extracted_data['bs'] = 'Y'
```

### B∆∞·ªõc 3: C·∫≠p Nh·∫≠t Schema Example

X√≥a tr∆∞·ªùng kh·ªèi example trong `schema_extra`.

## üîß C√°c Lo·∫°i Tr∆∞·ªùng Th∆∞·ªùng G·∫∑p

### 1. Tr∆∞·ªùng Boolean (Y/N)
```python
field_name: Optional[Literal['Y', 'N']] = Field(None, description="M√¥ t·∫£ tr∆∞·ªùng")
```

### 2. Tr∆∞·ªùng Text
```python
field_name: Optional[str] = Field(None, description="M√¥ t·∫£ tr∆∞·ªùng")
```

### 3. Tr∆∞·ªùng S·ªë
```python
field_name: Optional[str] = Field(None, description="M√¥ t·∫£ tr∆∞·ªùng (l∆∞u d∆∞·ªõi d·∫°ng string)")
```

### 4. Tr∆∞·ªùng Enum
```python
field_name: Optional[Literal['option1', 'option2', 'option3']] = Field(None, description="M√¥ t·∫£ tr∆∞·ªùng")
```

## üéØ C√°c V·ªã Tr√≠ Th√™m Tr∆∞·ªùng Theo Nh√≥m

### 1. Th√¥ng Tin ƒê·ªãa Ch·ªâ (d√≤ng 95-100)
```python
# ƒê·ªãa ch·ªâ
'postcode': None,
'prefecture': None,
# Th√™m tr∆∞·ªùng m·ªõi ·ªü ƒë√¢y
```

### 2. Th√¥ng Tin T√≤a Nh√† (d√≤ng 102-116)
```python
# Th√¥ng tin t√≤a nh√†
'building_type': None,
'year': None,
# Th√™m tr∆∞·ªùng m·ªõi ·ªü ƒë√¢y
```

### 3. Ti·ªán √çch T√≤a Nh√† (d√≤ng 148-151)
```python
# Ti·ªán √≠ch t√≤a nh√†
'autolock': None,
'credit_card': None,
# Th√™m tr∆∞·ªùng m·ªõi ·ªü ƒë√¢y
```

### 4. Ti·ªán Nghi CƒÉn H·ªô (d√≤ng 216-229)
```python
# Ti·ªán nghi cƒÉn h·ªô
'aircon': None,
'aircon_heater': None,
# Th√™m tr∆∞·ªùng m·ªõi ·ªü ƒë√¢y
```

## üß™ Testing Sau Khi Thay ƒê·ªïi

### 1. Ki·ªÉm Tra Syntax
```bash
python -c "from models import PropertyModel; print('Models OK')"
```

### 2. Ki·ªÉm Tra Import
```bash
python -c "from enhanced_crawler import PropertyExtractor; print('Crawler OK')"
```

### 3. Test V·ªõi D·ªØ Li·ªáu M·∫´u
```python
from models import PropertyModel

# Test t·∫°o model v·ªõi tr∆∞·ªùng m·ªõi
test_data = {
    'property_csv_id': 'TEST001',
    'security_system': 'Y',  # Tr∆∞·ªùng m·ªõi
    'noise_level': 'low'     # Tr∆∞·ªùng m·ªõi
}

try:
    property_obj = PropertyModel(**test_data)
    print("‚úÖ Model validation passed")
    print(f"Security System: {property_obj.security_system}")
    print(f"Noise Level: {property_obj.noise_level}")
except Exception as e:
    print(f"‚ùå Model validation failed: {e}")
```

## üìù Quy T·∫Øc ƒê·∫∑t T√™n Tr∆∞·ªùng

### 1. S·ª≠ d·ª•ng snake_case
```python
# ‚úÖ ƒê√∫ng
security_system: Optional[str] = Field(...)

# ‚ùå Sai
securitySystem: Optional[str] = Field(...)
SecuritySystem: Optional[str] = Field(...)
```

### 2. T√™n Tr∆∞·ªùng C√≥ √ù Nghƒ©a
```python
# ‚úÖ ƒê√∫ng
monthly_maintenance_fee: Optional[str] = Field(...)

# ‚ùå Sai
fee1: Optional[str] = Field(...)
```

### 3. Nh√≥m Tr∆∞·ªùng Li√™n Quan
```python
# ‚úÖ ƒê√∫ng - nh√≥m theo ch·ªß ƒë·ªÅ
security_system: Optional[str] = Field(...)
security_camera: Optional[str] = Field(...)
security_guard: Optional[str] = Field(...)
```

## üö® L∆∞u √ù Quan Tr·ªçng

### 1. Backup Tr∆∞·ªõc Khi Thay ƒê·ªïi
```bash
# Backup files quan tr·ªçng
copy models.py models.py.backup
copy enhanced_crawler.py enhanced_crawler.py.backup
```

### 2. Ki·ªÉm Tra T∆∞∆°ng Th√≠ch Ng∆∞·ª£c
- Khi x√≥a tr∆∞·ªùng, ƒë·∫£m b·∫£o kh√¥ng c√≥ code n√†o kh√°c ƒëang s·ª≠ d·ª•ng
- Khi th√™m tr∆∞·ªùng, ƒë·∫∑t default value l√† `None`

### 3. C·∫≠p Nh·∫≠t Documentation
- C·∫≠p nh·∫≠t m√¥ t·∫£ trong Field()
- C·∫≠p nh·∫≠t example trong schema_extra
- C·∫≠p nh·∫≠t README.md n·∫øu c·∫ßn

### 4. Performance Considerations
- Qu√° nhi·ªÅu tr∆∞·ªùng c√≥ th·ªÉ l√†m ch·∫≠m qu√° tr√¨nh crawl
- Ch·ªâ th√™m tr∆∞·ªùng th·ª±c s·ª± c·∫ßn thi·∫øt
- X√≥a tr∆∞·ªùng kh√¥ng s·ª≠ d·ª•ng ƒë·ªÉ t·ªëi ∆∞u performance

## üîç Debugging

### 1. Ki·ªÉm Tra Tr∆∞·ªùng N√†o ƒê∆∞·ª£c Extract
```python
# Th√™m v√†o enhanced_crawler.py ƒë·ªÉ debug
extracted_fields = [k for k, v in extracted_data.items() if v is not None]
print(f"üîç Extracted {len(extracted_fields)} fields: {extracted_fields}")
```

### 2. Ki·ªÉm Tra Gi√° Tr·ªã Tr∆∞·ªùng C·ª• Th·ªÉ
```python
# Debug tr∆∞·ªùng c·ª• th·ªÉ
if extracted_data.get('security_system'):
    print(f"üîí Security System: {extracted_data['security_system']}")
```

## üìö V√≠ D·ª• Ho√†n Ch·ªânh

### Th√™m Nh√≥m Tr∆∞·ªùng "Th√¥ng Tin H·ªçc ƒê∆∞·ªùng"

**1. Th√™m v√†o models.py:**
```python
# Th√¥ng tin h·ªçc ƒë∆∞·ªùng
school_elementary_nearby: Optional[Literal['Y', 'N']] = Field(None, description="C√≥ tr∆∞·ªùng ti·ªÉu h·ªçc g·∫ßn ƒë√≥ kh√¥ng? ('Y' ho·∫∑c 'N')")
school_middle_nearby: Optional[Literal['Y', 'N']] = Field(None, description="C√≥ tr∆∞·ªùng trung h·ªçc c∆° s·ªü g·∫ßn ƒë√≥ kh√¥ng? ('Y' ho·∫∑c 'N')")
school_high_nearby: Optional[Literal['Y', 'N']] = Field(None, description="C√≥ tr∆∞·ªùng trung h·ªçc ph·ªï th√¥ng g·∫ßn ƒë√≥ kh√¥ng? ('Y' ho·∫∑c 'N')")
school_university_nearby: Optional[Literal['Y', 'N']] = Field(None, description="C√≥ tr∆∞·ªùng ƒë·∫°i h·ªçc g·∫ßn ƒë√≥ kh√¥ng? ('Y' ho·∫∑c 'N')")
school_distance_elementary: Optional[str] = Field(None, description="Kho·∫£ng c√°ch ƒë·∫øn tr∆∞·ªùng ti·ªÉu h·ªçc g·∫ßn nh·∫•t (m√©t)")
```

**2. Th√™m v√†o enhanced_crawler.py:**
```python
# Trong _extract_comprehensive_data()
extracted_data = {
    # ... c√°c tr∆∞·ªùng hi·ªán t·∫°i ...
    
    # Th√¥ng tin h·ªçc ƒë∆∞·ªùng
    'school_elementary_nearby': None,
    'school_middle_nearby': None,
    'school_high_nearby': None,
    'school_university_nearby': None,
    'school_distance_elementary': None,
    
    # ... ti·∫øp t·ª•c ...
}

# Trong _extract_from_html_patterns()
# Extract th√¥ng tin h·ªçc ƒë∆∞·ªùng
if re.search(r'Â∞èÂ≠¶Ê†°|elementary school|ti·ªÉu h·ªçc', html, re.IGNORECASE):
    extracted_data['school_elementary_nearby'] = 'Y'

if re.search(r'‰∏≠Â≠¶Ê†°|middle school|trung h·ªçc c∆° s·ªü', html, re.IGNORECASE):
    extracted_data['school_middle_nearby'] = 'Y'

# Extract kho·∫£ng c√°ch
distance_match = re.search(r'Â∞èÂ≠¶Ê†°„Åæ„Åß(\d+)m|elementary school (\d+)m', html, re.IGNORECASE)
if distance_match:
    distance = distance_match.group(1) or distance_match.group(2)
    extracted_data['school_distance_elementary'] = distance
```

**3. C·∫≠p nh·∫≠t example:**
```python
schema_extra = {
    "example": {
        # ... c√°c tr∆∞·ªùng hi·ªán t·∫°i ...
        "school_elementary_nearby": "Y",
        "school_distance_elementary": "300"
    }
}
```

---

## üéâ K·∫øt Lu·∫≠n

Vi·ªác th√™m/x√≥a tr∆∞·ªùng trong d·ª± √°n n√†y kh√° ƒë∆°n gi·∫£n nh∆∞ng c·∫ßn th·ª±c hi·ªán ƒë·ªìng b·ªô ·ªü c·∫£ 2 file ch√≠nh. Lu√¥n nh·ªõ:

1. ‚úÖ C·∫≠p nh·∫≠t `models.py` tr∆∞·ªõc
2. ‚úÖ C·∫≠p nh·∫≠t `enhanced_crawler.py` sau
3. ‚úÖ Test k·ªπ l∆∞·ª°ng tr∆∞·ªõc khi deploy
4. ‚úÖ Backup tr∆∞·ªõc khi thay ƒë·ªïi
5. ‚úÖ ƒê·∫∑t t√™n tr∆∞·ªùng c√≥ √Ω nghƒ©a v√† nh·∫•t qu√°n

Ch√∫c b·∫°n th√†nh c√¥ng trong vi·ªác m·ªü r·ªông d·ª± √°n! üöÄ